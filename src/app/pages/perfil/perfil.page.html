<app-encabezado></app-encabezado>

<ion-content class="perfil-content">
  <div class="perfil-container">

    <!-- Cabecera del perfil -->
    <div class="perfil-header-section">
      <div class="perfil-top">
        <ion-avatar class="foto-perfil">
          <img [src]="fotoPerfil" [alt]="'Foto de perfil de ' + nombreUsuario" />
        </ion-avatar>
        <h2>{{ nombreUsuario }}</h2>
        <ion-button fill="clear" size="small" (click)="abrirOpciones()">
          <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- Estadísticas -->
      <div class="estadisticas">
        <div class="stat-item">
          <strong class="stat-button">{{ estadisticas.publicaciones }}</strong>
          <span class="texto-secundario">Publicaciones</span>
        </div>

        <div class="stat-item" [routerLink]="['/seguidores']">
          <strong class="color-verde">{{ estadisticas.seguidores }}</strong>
          <span class="texto-secundario">Seguidores</span>
        </div>

        <div class="stat-item" [routerLink]="['/seguidos']">
          <strong class="color-verde">{{ estadisticas.seguidos }}</strong>
          <span class="texto-secundario">Seguidos</span>
        </div>
      </div>
    </div>

    <!-- Bio -->
    <div class="perfil-bio">
      <p style="margin-bottom: 0;">{{ subname }}</p>
      <p class="texto-secundario descripcion-texto" style="margin-top: 0;">
        {{ descripcionBio }}
      </p>
    </div>

    <!-- Navegación de publicaciones/eventos -->
    <div #publicacionesNav class="publicaciones-nav">
      <ion-segment [(ngModel)]="vistaSeleccionada" (ionChange)="segmentChanged($event)">
        <ion-segment-button value="publicaciones">
          <ion-icon name="grid-outline"></ion-icon>
        </ion-segment-button>
        <ion-segment-button value="eventos-inscritos">
          <ion-icon name="flash-outline"></ion-icon>
        </ion-segment-button>
        <ion-segment-button value="eventos-creados">
          <ion-icon name="game-controller-outline"></ion-icon>
        </ion-segment-button>
      </ion-segment>
    </div>

    <!-- Publicaciones (modo lista) -->
<div class="publicaciones-grid" *ngIf="vistaSeleccionada === 'publicaciones'">

  <div *ngIf="publicaciones.length === 0; else listaPublicaciones" class="no-publicaciones-container">
    <ion-icon name="folder-open-outline" size="large" ></ion-icon>
    <p>Aún no hay publicaciones.</p>
  </div>

  <ng-template #listaPublicaciones>
    <ion-list lines="none">
      <!-- Publicación -->
      <div class="bordes">
        <ion-card *ngFor="let publicacion of publicacionesFiltradas">

          <ion-item>
            <ion-avatar slot="start">
              <img [src]="fotoPerfil" [alt]="'Foto de perfil de ' + nombreUsuario" />
            </ion-avatar>
            <ion-label class="etiqueta-usuario">
              <h2>{{ nombreUsuario }}</h2>
              <p>{{ publicacion.fecha_publicacion | date: 'short' }}</p>
            </ion-label>

            <!-- Botón de opciones -->
            <ion-button fill="clear" size="small" (click)="opcion(publicacion)">
              <ion-icon name="ellipsis-horizontal-outline"></ion-icon>
            </ion-button>
          </ion-item>

          <!-- Parte donde se muestra imagen o descripción, centrado -->
          <div style="display: flex; justify-content: center; align-items: center; flex-direction: column; text-align: center;">
            <ng-container *ngIf="publicacion.imagen; else soloDescripcion">
              <img [src]="publicacion.imagen" class="post-image" (click)="comentario(publicacion)" />
            </ng-container>

            <ng-template #soloDescripcion>
              <ion-card-content (click)="comentario(publicacion)">
                <p class="descripcion-sola">{{ publicacion.contenido }}</p>
              </ion-card-content>
            </ng-template>
          </div>

        </ion-card>
      </div>
    </ion-list>
  </ng-template>

</div>


    <!-- Eventos inscritos (modo reels) -->
    <div class="eventos-inscritos" *ngIf="vistaSeleccionada === 'eventos-inscritos'">
      <h2 class="titulo-seccion">Eventos inscritos</h2>

      <div *ngFor="let evento of eventosinscritos" class="tarjeta-evento">
        <ion-card>
          <ion-card-content class="contenido-tarjeta">
            <div class="texto-tarjeta">
              <h3 class="titulo-evento">{{ evento.nombre }}</h3>
              <p class="detalle">Creador: {{ evento.creador }}</p>
              <p class="detalle">Fecha: {{ evento.fecha }}</p>
              <p class="detalle">Juego: {{ evento.juego }}</p>
            </div>
            <ion-icon
              name="chevron-forward-outline"
              class="color-verde icono-forward"
              size="large"
              [routerLink]="['/event-insc-cread', evento.id, 'Evento inscrito']"
            >
            </ion-icon>
          </ion-card-content>
        </ion-card>
      </div>
    </div>

    <!-- Eventos creados -->
    <div class="eventos-inscritos" *ngIf="vistaSeleccionada === 'eventos-creados'">
      <h2 class="titulo-seccion">Eventos creados</h2>

      <div *ngFor="let evento of eventosCreados" class="tarjeta-evento">
        <ion-card>
          <ion-card-content class="contenido-tarjeta">
            <div class="texto-tarjeta">
              <h3 class="titulo-evento">{{ evento.nombre }}</h3>
              <p class="detalle">Fecha: {{ evento.fecha }}</p>
              <p class="detalle">Juego: {{ evento.juego }}</p>
            </div>
            <ion-icon
              name="chevron-forward-outline"
              class="color-verde icono-forward"
              size="large"
              [routerLink]="['/event-insc-cread', evento.id, 'Evento Creado']"
            >
            </ion-icon>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>
</ion-content>

<app-navbar></app-navbar>
